import React, { useState, useEffect } from "react";
import Sidebar from "../components/Sidebar";
import { useEmployees } from "../context/EmployeesContext";

function AllInvoices() {
  const { getAllInvoices } = useEmployees();
  const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
  const [companyInfo, setCompanyInfo] = useState(null);

  useEffect(() => {
    const savedCompany = localStorage.getItem('currentCompany');
    if (savedCompany) {
      setCompanyInfo(JSON.parse(savedCompany));
    }
  }, []);

  const invoices = getAllInvoices(selectedMonth, selectedYear);

  const months = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];

  const years = [2023, 2024, 2025];

  return (
    <div className="dashboard-container">
      <Sidebar role="employer" />
      <div className="dashboard-content">
        <header className="dashboard-header">
          <h1>All Invoices</h1>
          <p>View all invoices across all employees</p>
          {companyInfo && (
            <div className="company-info-display">
              <strong>Company:</strong> {companyInfo.companyName}
            </div>
          )}
        </header>

        <div className="invoice-controls">
          <div className="form-row">
            <div className="form-group">
              <label>Month</label>
              <select 
                value={selectedMonth} 
                onChange={(e) => setSelectedMonth(parseInt(e.target.value))}
                className="form-input"
              >
                {months.map((month, index) => (
                  <option key={month} value={index}>
                    {month}
                  </option>
                ))}
              </select>
            </div>
            <div className="form-group">
              <label>Year</label>
              <select 
                value={selectedYear} 
                onChange={(e) => setSelectedYear(parseInt(e.target.value))}
                className="form-input"
              >
                {years.map(year => (
                  <option key={year} value={year}>
                    {year}
                  </option>
                ))}
              </select>
            </div>
          </div>
        </div>

        <div className="invoices-grid">
          {invoices.map((invoice, index) => (
            <div key={index} className="invoice-card">
              <div className="invoice-header">
                <h3>{invoice.client}</h3>
                <span className="invoice-employee">Employee: {invoice.employee}</span>
              </div>
              <div className="invoice-details">
                <p><strong>Sessions:</strong> {invoice.lineItems.length}</p>
                <p><strong>Subtotal:</strong> R{invoice.subtotal.toFixed(2)}</p>
                <p><strong>VAT:</strong> R{invoice.vat.toFixed(2)}</p>
                <p><strong>Total:</strong> R{invoice.total.toFixed(2)}</p>
              </div>
              <div className="invoice-actions">
                <button className="secondary-btn">View Details</button>
                <button className="primary-btn">Download</button>
              </div>
            </div>
          ))}
        </div>

        {invoices.length === 0 && (
          <div className="no-data">
            <p>No invoices found for {months[selectedMonth]} {selectedYear}</p>
          </div>
        )}
      </div>
    </div>
  );
}

export default AllInvoices;
